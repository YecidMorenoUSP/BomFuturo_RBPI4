{% extends "base.html" %}

{% block content %}

<link rel="stylesheet" href="/static/Main/css/Main.css">
<!-- <link rel="stylesheet" href="{{ url_for('static', filename='Main/css/Main.css') }}"> -->

<!-- Cover Image  -->

<div class="container-fluid">
        <!-- Example row of columns -->
        <div class="row">
            <div class="container-fluid" id="data-container"></div>
        </div>
</div>

<!-- <div class="ct-chart ct-perfect-fourth"></div> -->
<script>
        var chart;
        var dd;
        
        var cur_time = NaN
        function requestData()
        {
            // Ajax call to get the Data from Flask
            var requests = $.get('/Humidity/humidity?from='+cur_time);

            // request is complete
            var tm = requests.done(function (result)
            {               
                               

                // add the point
                // chart.series[0].addPoint([result[0][0],result[0][1]], true, shift);
                // chart.series[1].addPoint([result[0],result[2]], true, shift);
                
                

                // result.forEach(d=>{ 
                //     chart.series[0].addPoint([d[0],d[1]], true, false);
                // })

                
                dd = []
                result.forEach(d=>{ 
                    dd.push([d[0],d[1]]) 
                })

                if(dd.length > 0){
                    if(isNaN(cur_time)){
                        chart.series[0].setData(dd)
                    }else{
                                                
                        dd.forEach(d => {
                            chart.series[0].addPoint([d[0],d[1]], true, true);
                        });

                    }
                    cur_time = dd.slice(-1)[0][0]
                }               
                

                // call it again after one second
                setTimeout(requestData, 10000);

            });
        }

        $(document).ready(function() {
            
            Highcharts.setOptions({
                plotOptions: {
                    series: {
                        animation: false
                    }
                }
            });

            chart = new Highcharts.Chart({
                chart: {
                    renderTo: 'data-container',
                    defaultSeriesType: 'spline',
                    events: {
                        load: requestData
                    },
                    
                },
                title: {
                    text: 'Live humidity of cotton'
                },
                xAxis: {
                    type: 'datetime',
                    tickPixelInterval: 150,
                    maxZoom: 110 
                },
                yAxis: {
                    min: 0,
                    max: 100,
                    minPadding: 0.2,
                    maxPadding: 0.2,
                    title: {
                        text: 'Percentage %',
                        margin: 80
                    }
                },
                series: [{
                    name: 'Relative',
                    data: []
                },
                
                ]
            });



        });

</script>
<script src="/static/Main/js/Main.js"></script>

{% endblock %}